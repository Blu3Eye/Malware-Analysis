import idautils 
import idaapi
import idc 
import time
#data = [78,84,68,76,76,46,68,76,76,0,78,84,68,83,65,80,73,46,68,76,76,0,75,69,82,78,69,76,51,50,46,68,76,76,0,90,119,83,101,116,67,111,110,116,101,120,116,84,104,114,101,97,100,0,90,119,71,101,116,67,111,110,116,101,120,116,84,104,114,101,97,100,0,90,119,87,111,119,54,52,82,101,97,100,86,105,114,116,117,97,108,77,101,109,111,114,121,54,52,0,90,119,87,111,119,54,52,81,117,101,114,121,73,110,102,111,114,109,97,116,105,111,110,80,114,111,99,101,115,115,54,52,0,46,98,105,110,0,76,111,97,100,76,105,98,114,97,114,121,65,0,37,48,50,117,45,37,48,50,117,45,37,48,50,117,32,37,48,50,117,58,37,48,50,117,58,37,48,50,117,13,10,0,54,52,0,82,116,108,69,120,105,116,85,115,101,114,84,104,114,101,97,100,0,42,0,46,0,42,0,0,0,76,100,114,71,101,116,80,114,111,99,101,100,117,114,101,65,100,100,114,101,115,115,0,67,114,101,97,116,101,82,101,109,111,116,101,84,104,114,101,97,100,0,90,119,87,114,105,116,101,86,105,114,116,117,97,108,77,101,109,111,114,121,0,76,100,114,76,111,97,100,68,108,108,0,90,119,80,114,111,116,101,99,116,86,105,114,116,117,97,108,77,101,109,111,114,121,0,107,101,114,110,101,108,98,97,115,101,0,76,100,114,82,101,103,105,115,116,101,114,68,108,108,78,111,116,105,102,105,99,97,116,105,111,110,0,76,100,114,85,110,114,101,103,105,115,116,101,114,68,108,108,78,111,116,105,102,105,99,97,116,105,111,110,0,67,114,101,97,116,101,80,114,111,99,101,115,115,65,0,67,114,101,97,116,101,80,114,111,99,101,115,115,87,0,67,114,101,97,116,101,80,114,111,99,101,115,115,65,115,85,115,101,114,65,0,67,114,101,97,116,101,80,114,111,99,101,115,115,65,115,85,115,101,114,87,0,118,101,114,115,105,111,110,61,37,117,38,115,111,102,116,61,37,117,38,117,115,101,114,61,37,48,56,120,37,48,56,120,37,48,56,120,37,48,56,120,38,115,101,114,118,101,114,61,37,117,38,105,100,61,37,117,38,116,121,112,101,61,37,117,38,110,97,109,101,61,37,115,0,73,115,87,111,119,54,52,80,114,111,99,101,115,115,0,77,0,105,0,99,0,114,0,111,0,115,0,111,0,102,0,116,0,0,0,87,111,119,54,52,69,110,97,98,108,101,87,111,119,54,52,70,115,82,101,100,105,114,101,99,116,105,111,110,0,68,58,40,68,59,79,73,67,73,59,71,65,59,59,59,66,71,41,40,68,59,79,73,67,73,59,71,65,59,59,59,65,78,41,40,65,59,79,73,67,73,59,71,65,59,59,59,65,85,41,40,65,59,79,73,67,73,59,71,65,59,59,59,66,65,41]
data = [90,119,77,97,112,86,105,101,119,79,102,83,101,99,116,105,111,110,0,78,84,68,76,76,46,68,76,76,0,76,100,114,85,110,114,101,103,105,115,116,101,114,68,108,108,78,111,116,105,102,105,99,97,116,105,111,110,0,90,119,67,114,101,97,116,101,83,101,99,116,105,111,110,0,76,111,99,97,108,92,0,82,116,108,78,116,83,116,97,116,117,115,84,111,68,111,115,69,114,114,111,114,0,90,119,67,108,111,115,101,0,75,69,82,78,69,76,51,50,46,68,76,76,0,123,37,48,56,88,45,37,48,52,88,45,37,48,52,88,45,37,48,52,88,45,37,48,56,88,37,48,52,88,125,0,54,52,0,46,98,105,110,0,76,111,97,100,76,105,98,114,97,114,121,65,0,37,0,83,0,37,0,120,0,0,0,107,101,114,110,101,108,98,97,115,101,0,76,100,114,82,101,103,105,115,116,101,114,68,108,108,78,111,116,105,102,105,99,97,116,105,111,110,0,77,0,105,0,99,0,114,0,111,0,115,0,111,0,102,0,116,0,0,0,90,119,85,110,109,97,112,86,105,101,119,79,102,83,101,99,116,105,111,110,0,90,119,87,114,105,116,101,86,105,114,116,117,97,108,77,101,109,111,114,121,0,90,119,80,114,111,116,101,99,116,86,105,114,116,117,97,108,77,101,109,111,114,121,0,37,48,50,117,45,37,48,50,117,45,37,48,50,117,32,37,48,50,117,58,37,48,50,117,58,37,48,50,117,13,10,0,78,84,68,83,65,80,73,46,68,76,76,0,83,58,40,77,76,59,59,78,87,59,59,59,76,87,41,68,58,40,65,59,59,48,120,49,102,102,102,102,102,59,59,59,87,68,41,40,65,59,59,48,120,49,102,102,102,102,102,59,59,59,83,45,49,45,49,53,45,50,45,49,41,40,65,59,59,48,120,49,102,102,102,102,102,59,59,59,83,45,49,45,49,53,45,51,45,49,41,0,37,48,56,88,45,37,48,52,88,45,37,48,52,88,45,37,48,52,88,45,37,48,56,88,37,48,52,88,0,67,111,112,121,114,105,103,104,116,32,194,169,32,50,48,49,57,32,77,105,99,114,111,115,111,102,116,32,67,111,114,112,46,32,65,108,108,32,114,105,103,104,116,115,32,114,101,115,101,114,118,101,100,46,0,90,119,83,101,116,67,111,110,116,101,120,116,84,104,114,101,97,100,0,90,119,71,101,116,67,111,110,116,101,120,116,84,104,114,101,97,100,0,90,119,87,111,119,54,52,82,101,97,100,86,105,114,116,117,97,108,77,101,109,111,114,121,54,52,0,90,119,87,111,119,54,52,81,117,101,114,121,73,110,102,111,114,109,97,116,105,111,110,80,114,111,99,101,115,115,54,52,0,87,111,119,54,52,69,110,97,98,108,101,87,111,119,54,52,70,115,82,101,100,105,114,101,99,116,105,111,110,0,68,58,40,68,59,79,73,67,73,59,71,65,59,59,59,66,71,41,40,68,59,79,73,67,73,59,71,65,59,59,59,65,78,41,40,65,59,79,73,67,73,59,71,65,59,59,59,65,85,41,40,65,59,79,73,67,73,59,71,65,59,59,59,66,65,41,0,73,115,87,111,119,54,52,80,114,111,99,101,115,115,0,0]

#get start address of bss segment of ISFB 
def find_bss():
    for ea in idautils.Segments():
        seg = idaapi.getseg(ea)
        name = idaapi.get_segm_name(seg)
        if ".bss" in name:
            print("[+]Located bss segment[+]")
            start = idc.get_segm_start(ea)
            return start


def patch_bytes(dst , decrypt_bytes):
    print(f"[+]Patching started at...")
    time.sleep(6)
    i = 0 
    for byte in decrypt_bytes:
        idc.patch_byte(dst+i,byte)
        i+=1
    print("[+]Done patching")

def main():
    start = find_bss()
    patch_bytes(start,data)


if __name__ == "__main__":
    main()
            


