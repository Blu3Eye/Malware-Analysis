import pefile
import sys

def calc_hash(name):
    running_hash = 0
    for c in name:
        tmp = ((ord(c) | 0x60 ) + running_hash) & 0xffffffff
        running_hash = 2 * tmp
    return running_hash
if __name__ == "__main__":
#try loading and parsing kernel32,enumerate for exports and calc exported function hashes
    try:
        pe = pefile.PE("C:\\Windows\\SysWOW64\\kernel32.dll")
        if (hasattr(pe,"DIRECTORY_ENTRY_EXPORT")):
            for exp in pe.DIRECTORY_ENTRY_EXPORT.symbols:
                if not exp.name:
                    continue
                if calc_hash(exp.name.decode('utf-8')) == int(sys.argv[1],16):
                    print(f"{exp.name.decode('utf-8')} => {hex(calc_hash(exp.name.decode('utf-8')))}")

    except pefile.PEFortmatError as e:
        print("[+]PEFormatError: %s" % e.value)
